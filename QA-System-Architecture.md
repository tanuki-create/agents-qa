# QA システムアーキテクチャ

## プロジェクト概要

このプロジェクトは質問応答（QA）システムを実装しています。ユーザーが質問を投稿し、AIエージェントがそれに回答するウェブサービスです。システムはExpressフレームワークを使用したバックエンド、Supabaseをデータベースとして、Google Gemini AIモデルを使って質問に回答します。

## システム構造

プロジェクトは以下のディレクトリ構造で構成されています：

```
src/
├── agents/       # AIエージェント実装
├── config/       # 設定ファイル
├── routes/       # APIエンドポイント
├── scripts/      # スクリプト
├── services/     # サービス
├── types/        # 型定義
└── index.ts      # メインアプリケーションファイル
```

## 各ファイルの役割

### メインファイル

#### `src/index.ts`

アプリケーションのエントリーポイントです。Express サーバーを設定し、ルートを登録し、APIエンドポイントを初期化します。QAエージェントを初期化し、Webサーバーを起動します。

### 設定

#### `src/config/supabase.ts`

Supabaseクライアントを設定し、データベースへの接続を確立します。また、データベースのテーブル名を定数として定義しています：
- QUESTIONS
- ANSWERS
- AGENTS
- USERS

### 型定義

#### `src/types/index.ts`

システム全体で使用される型定義を含みます：
- `Question` - 質問のデータ構造
- `Answer` - 回答のデータ構造
- `Agent` - AIエージェントのデータ構造
- `User` - ユーザーのデータ構造
- `QAResult` - QAエージェントの結果データ構造
- `QAAgent` - QAエージェントのインターフェース

### エージェント

#### `src/agents/qaAgent.ts`

質問応答エージェントを実装しています。Google Gemini AIモデルを使用して：
1. 質問に対する回答を生成
2. 回答の質を評価（0-100のスコア）
3. 高品質の回答（スコア80以上）が得られるまで最大3回繰り返す

### ルート

#### `src/routes/answers.ts`

回答生成と管理のためのAPIエンドポイント：
- `POST /` - 新しい回答を生成する
  - 質問とエージェントIDを受け取り
  - QAエージェントを使って回答を生成
  - 結果をデータベースに保存
  - 質問ステータスを更新

#### `src/routes/questions.ts`

質問の管理のためのAPIエンドポイント：
- 質問の作成
- 質問のリスト取得
- 特定の質問の取得
- 質問のステータス更新

#### `src/routes/users.ts`

ユーザー管理用のAPIエンドポイント：
- ユーザーの登録
- ユーザープロファイルの取得
- ユーザーリストの取得

#### `src/routes/agents.ts`

AIエージェント管理用のAPIエンドポイント：
- エージェントの登録
- エージェントリストの取得
- 特定のエージェントの取得

### サービス

#### `src/services/agentSelector.ts`

質問に最適なAIエージェントを選択するサービス：
1. すべてのエージェントをデータベースから取得
2. Google Gemini AIを使って各エージェントの質問に対する適合性を評価（0-100のスコア）
3. 最高スコアのエージェントを選択して返す

## データフロー

1. ユーザーが質問を投稿
2. システムが質問をデータベースに保存
3. システムが最適なエージェントを選択
4. 選択されたエージェントが質問に回答
5. 回答がデータベースに保存
6. 質問のステータスが「answered」に更新
7. ユーザーが質問と回答を閲覧可能

## 技術スタック

- **バックエンド**: Node.js, Express
- **データベース**: Supabase
- **AI**: Google Gemini AI (langchain/google-genai)
- **言語**: TypeScript

## プロジェクトの目的

このプロジェクトは、AIを活用した質問応答システムを提供することを目的としています。複数のAIエージェントを活用して、様々な専門分野の質問に対応します。主な特徴は：

1. ユーザーが質問を投稿できる
2. 質問に最適なAIエージェントを自動選択
3. AIが質問に回答し、高品質の回答が得られるまで反復処理
4. 回答の質をスコアリング
5. 質問と回答の履歴を保持

これにより、専門知識を持つAIアシスタントへのアクセスを提供し、ユーザーの質問に効率的に回答することができます。 